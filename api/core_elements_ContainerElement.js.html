<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Source: core/elements/ContainerElement.js</title>
    
    
    
    
    
    <meta property="og:title" content=""/>
    <meta property="og:type" content="website"/>
    <meta property="og:image" content=""/>
    
    <meta property="og:url" content=""/>
    
    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <script src="scripts/jquery.min.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/bootstrap.min.css">
    <link type="text/css" rel="stylesheet" href="styles/jaguar.css">
    
    
    <script>
    var config = {"monospaceLinks":false,"cleverLinks":false,"default":{"outputSourceFiles":true},"applicationName":"POM","footer":"","copyright":"","disqus":"","googleAnalytics":"","openGraph":{"title":"","type":"website","image":"","site_name":"","url":""},"meta":{"title":"","description":"","keyword":""},"linenums":true};
    </script>
    

    
</head>
<body>
<div id="wrap" class="clearfix">
    
<div class="navigation">
    <h3 class="applicationName"><a href="index.html">POM</a></h3>

    <div class="search">
        <input id="search" type="text" class="form-control input-sm" placeholder="Search Documentations">
    </div>
    <ul class="list">
    
        <li class="item" data-name="POM">
            <span class="title">
                <a href="POM.html">POM</a>
                
                <span class="static">static</span>
                
            </span>
            <ul class="members itemMembers">
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="methods itemMembers">
            
            </ul>
            <ul class="events itemMembers">
            
            </ul>
        </li>
    
        <li class="item" data-name="POM.ContainerElement">
            <span class="title">
                <a href="POM.ContainerElement.html">POM.ContainerElement</a>
                
            </span>
            <ul class="members itemMembers">
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="methods itemMembers">
            
            <span class="subtitle">Methods</span>
            
                <li data-name="POM.ContainerElement#getChildByNameRecursive"><a href="POM.ContainerElement.html#getChildByNameRecursive">getChildByNameRecursive</a></li>
            
                <li data-name="POM.ContainerElement#getData"><a href="POM.ContainerElement.html#getData">getData</a></li>
            
                <li data-name="POM.ContainerElement#removeChildByNameRecursive"><a href="POM.ContainerElement.html#removeChildByNameRecursive">removeChildByNameRecursive</a></li>
            
                <li data-name="POM.ContainerElement#setData"><a href="POM.ContainerElement.html#setData">setData</a></li>
            
                <li data-name="POM.ContainerElement#updateData"><a href="POM.ContainerElement.html#updateData">updateData</a></li>
            
            </ul>
            <ul class="events itemMembers">
            
            </ul>
        </li>
    
        <li class="item" data-name="POM.GraphicsElement">
            <span class="title">
                <a href="POM.GraphicsElement.html">POM.GraphicsElement</a>
                
            </span>
            <ul class="members itemMembers">
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="methods itemMembers">
            
            <span class="subtitle">Methods</span>
            
                <li data-name="POM.GraphicsElement#getData"><a href="POM.GraphicsElement.html#getData">getData</a></li>
            
                <li data-name="POM.GraphicsElement#updateData"><a href="POM.GraphicsElement.html#updateData">updateData</a></li>
            
            </ul>
            <ul class="events itemMembers">
            
            </ul>
        </li>
    
        <li class="item" data-name="POM.Manager">
            <span class="title">
                <a href="POM.Manager.html">POM.Manager</a>
                
            </span>
            <ul class="members itemMembers">
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="methods itemMembers">
            
            <span class="subtitle">Methods</span>
            
                <li data-name="POM.Manager#createElementFromData"><a href="POM.Manager.html#createElementFromData">createElementFromData</a></li>
            
                <li data-name="POM.Manager#destroyPlugins"><a href="POM.Manager.html#destroyPlugins">destroyPlugins</a></li>
            
                <li data-name="POM.Manager#initPlugins"><a href="POM.Manager.html#initPlugins">initPlugins</a></li>
            
                <li data-name="POM.Manager#registerPlugin"><a href="POM.Manager.html#registerPlugin">registerPlugin</a></li>
            
                <li data-name="POM.Manager#registerPrototype"><a href="POM.Manager.html#registerPrototype">registerPrototype</a></li>
            
            </ul>
            <ul class="events itemMembers">
            
            </ul>
        </li>
    
        <li class="item" data-name="POM.SpriteElement">
            <span class="title">
                <a href="POM.SpriteElement.html">POM.SpriteElement</a>
                
            </span>
            <ul class="members itemMembers">
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="methods itemMembers">
            
            <span class="subtitle">Methods</span>
            
                <li data-name="POM.SpriteElement#getData"><a href="POM.SpriteElement.html#getData">getData</a></li>
            
                <li data-name="POM.SpriteElement#updateData"><a href="POM.SpriteElement.html#updateData">updateData</a></li>
            
            </ul>
            <ul class="events itemMembers">
            
            </ul>
        </li>
    
    </ul>
</div>
    <div class="main">
        <h1 class="page-title" data-filename="core_elements_ContainerElement.js.html">Source: core/elements/ContainerElement.js</h1>
        


    
    <section>
        <article>
            <pre id="source-code" class="prettyprint source linenums"><code>var updateData = require('../../extras/updateData');
var getData = require('../../extras/getData');
var setData = require('../../extras/setData');
var CONST = require('../const');
var helpers = require('../../extras/helpers');

/**
 * POM Container Element
 * @class ContainerElement
 * @extends PIXI.Container
 * @memberof POM
 * @constructor
 * @param manager the core manager
 * @param data data for the element
 */
function ContainerElement(manager, data) {
    PIXI.Container.call(this);
    this.manager = manager;
    this.type = 'container';
    this.minWidth = 0;
    this.minHeight = 0;
    this._hasFlags = this._updateFlags.length > 0;
    this.updateData(data || {});
}

ContainerElement.prototype = Object.create(PIXI.Container.prototype);
module.exports = ContainerElement;

ContainerElement.prototype._updateFlags = [];

/**
 * Update data of objects from JSON decoded object
 *
 * @param data {Object} JSON decoded object representing the content
 */
ContainerElement.prototype.updateData = function (data) {
    if (data.children) {
        this.updateChildren(data.children);
    }

    updateData(this, data);
};

/**
 * Sets data of objects from JSON decoded object
 *
 * @param data {Object} JSON decoded object representing the content
 */
ContainerElement.prototype.setData = function(data){
    data = data || {};

    this.setChildren(data.children);
    setData(this, data);
};

/**
 * get data of SpriteElement (including defaults)
 *
 * @returns data {Object} representing the container (and its children)
 */
ContainerElement.prototype.getData = function () {
    var children = [];
    for (var i = 0; i &lt; this.children.length; i++) {
        children.push(this.children[i].getData());
    }
    var data = getData(this);
    data.children = children;
    return data;
};


/**
 * Removes element with a given name - if it exists.
 * searches all children for the element with this name
 *
 * @param name {String} The name of the element to be removed
 */
ContainerElement.prototype.removeChildByNameRecursive = function (name) {
    var child = this.getChildByNameRecursive(name);
    if (child) {
        child.parent.removeChild(child);
    }
};

/**
 * Get element with given name - if it exists.
 * searches all children for the element with this name
 *
 * @param name {String} The name of the element to be found
 */
ContainerElement.prototype.getChildByNameRecursive = function (name) {
    for (var i = 0; i &lt; this.children.length; i++) {
        var child = this.children[i];
        if (child.name == name) {
            return child;
        }
        if (typeof(child.getChildByNameRecursive) !== 'undefined') {
            child = child.getChildByNameRecursive(name);
            if (child !== null) {
                return child;
            }
        }
    }
    return null;
};

/**
 * Generate children from JSON data
 *
 * @param children {Array} data of children
 * @private
 */
//TODO Evaluate whether an UPDATE function should remove ALL data, instead of replacing old data with new data
ContainerElement.prototype.updateChildren = function (children) {
    this.destroyChildren();
    for (var i = 0; i &lt; children.length; i++) {
        this.addChild(this.manager.createElementFromData(children[i]));
    }
};

ContainerElement.prototype.destroyChildren = function(){
    var children = this.removeChildren();
    for(var i=0;i&lt;children.length;i++){
        var child = children[i];
        if(child.destroy){
            child.destroy();
        }
    }
};

ContainerElement.prototype.setChildren = function(children){
    if(children){
        this.destroyChildren();
        for (var i = 0; i &lt; children.length; i++) {
            this.addChild(this.manager.createElementFromData(children[i]));
        }
    }
};


ContainerElement.prototype._getDataKeys = function () {
    return helpers.deepClone(CONST.DEFAULT_DATAKEYS);
};



ContainerElement.prototype.toLocal = function(global, from){
    if(this.resizeScaling){
        var local = PIXI.Container.prototype.toLocal.call(this, global, from);
        local.x *=  this.localScaleX;
        local.y *= this.localScaleY;

        return local;
    } else {
        return PIXI.Container.prototype.toLocal.call(this, global, from);
    }
};

ContainerElement.prototype._checkFlags = function(){
    for(var i=0, j=this._updateFlags.length;i&lt;j;i++){
        var flag = this._updateFlags[i];

        if(this[flag.name]){

            var func;
            if(typeof flag.func === 'string'){
                func = this[flag.func];
            }else {
                func =flag.func
            }

            if(func){
                this[flag.name] = func.call(this);
            }else{
                console.log('Could not update flag ' + flag.name + ' on Element of type ' + this.type);
            }
        }
    }
};


// TODO add a toGlobal function too
// TODO merge this with GOWN.utils.resizeScaling
ContainerElement.prototype.updateTransform = function () {



    var i, j;
    var wt = this.worldTransform;
    // obmit Control.updateTransform as it calls redraw as well
    if (!this.resizeScaling) {
        if (this.redraw) {
            this.redraw(1, 1);
        }

        if(this._hasFlags){
            this._checkFlags();
        }

        PIXI.Container.prototype.updateTransform.call(this);
    } else {
        var pt = this.parent.worldTransform;
        var scaleX = Math.sqrt(Math.pow(pt.a, 2) + Math.pow(pt.b, 2));
        var scaleY = Math.sqrt(Math.pow(pt.c, 2) + Math.pow(pt.d, 2));
        this.worldWidth = Math.round(Math.max(this.width * scaleX, this.minWidth));
        this.worldHeight = Math.round(Math.max(this.height * scaleY, this.minHeight));

        PIXI.DisplayObject.prototype.updateTransform.call(this);

        // revert scaling
        var tx = wt.tx;
        var ty = wt.ty;

        wt.scale(scaleX !== 0 ? 1 / scaleX : 0, scaleY !== 0 ? 1 / scaleY : 0);
        wt.tx = tx;
        wt.ty = ty;

        if (this.redraw) {
            this.redraw(scaleX, scaleY);
        }

        this.localScaleX = scaleX;
        this.localScaleY = scaleY;


        if(this._hasFlags){
            this._checkFlags();
        }

        for (i = 0, j = this.children.length; i &lt; j; ++i) {
            this.children[i].updateTransform();
        }
    }
};

// performance increase to avoid using call.. (10x faster)
//Copied from PIXI //TODO Actually use this
ContainerElement.prototype.pomContainerUpdateTransform = ContainerElement.prototype.updateTransform


Object.defineProperties(ContainerElement.prototype, {
    dataKeys: {
        get: ContainerElement.prototype._getDataKeys
    }
});
</code></pre>
        </article>
    </section>






        

        <footer>
            Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.4.3</a> on Fri Nov 25 2016 14:13:16 GMT+0100 (CET)
        </footer>
    </div>
</div>
<script>prettyPrint();</script>
<script src="scripts/jaguar.js"></script>
</body>
</html>
